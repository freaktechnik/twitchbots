{%- macro status(value) -%}
{% if value -%}
<span class="glyphicon glyphicon-ok-sign status-ok" title="Yes"></span>
{%- elseif value is not null -%}
<span class="glyphicon glyphicon-remove-sign status-nok" title="No"></span>
{%- else -%}
<span class="glyphicon glyphicon-question-sign status-unknown" title="No data"></span>
{%- endif %}
{%- endmacro -%}
{%- macro table(set, id, active, buttons, token) -%}
{%- from _self import status -%}
{% set defaultVal = status(null) %}
<div class="table-responsive tab-pane{% if active %} active{% endif %}" role="tabpanel" id="{{ id|e('html_attr') }}">
    <table class="table table-striped">
        <thead>
            <tr>
                <th>Username</th>
                <th>Description</th>
                <th>Channel</th>
                <th><abbr title="Amount of followed channels by the bot">Following</abbr></th>
                <th>Bio</th>
                <th><abbr title="Bot channel has VODs">VODs</abbr></th>
                <th><abbr title="Is in chat when channel is offline">Off</abbr></th>
                <th><abbr title="Is in chat when channel is live">On</abbr></th>
                <th><abbr title="Is modded in the channel's chat">Mod</abbr></th>
                <th><abbr title="Is following the channel">Follows</abbr></th>
                <th>Score</th>
                {% if buttons %}
                <th>
                    <abbr title="Approve Submission">
                        <span class="glyphicon glyphicon-ok" aria-hidden="true"></span>
                    </abbr>
                </th>
                <th>
                    <abbr title="Edit Submission">
                        <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>
                    </abbr>
                </th>
                <th>
                    <abbr title="Reject Submission">
                        <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
                    </abbr>
                </th>
                {% endif %}
            </tr>
        </thead>
        <tbody>
{% for s in set %}
{%- set botUrl = 'https://twitch.tv/' ~ s.name|e('url') -%}
{% if s.description matches '/^\\d+$/' %}
    {% set isType = true %}
{% else %}
    {% set isType = false %}
{% endif %}
            <tr>
                <td>{% if s.type == 0 -%}
                    <a href="{{ botUrl|e('html_attr') }}" title="{{ s.name|e('html_attr') }} on Twitch" rel="external nofollow">{{ s.name|e }}</a>
                {%- else -%}
                    <a href="{{ urlFor('bot', { name: s.name }) }}" title="{{ s.name|e('html_attr') }} in the Twitch Bots Directory">{{ s.name|e }}</a>
                {%- endif %}</td>
                <td>{% spaceless %}
                    {% if isType %}
                        <a href="{{ urlFor('type', { id: s.description})|e('html_attr') }}">{{ s.description|e }}</a>
                    {% else %}
                        {{ s.description|e }}
                    {% endif %}
                {% endspaceless %}</td>
                <td>{% if s.channel is not empty %}<a href="https://twitch.tv/{{ s.channel|e('url')|e('html_attr') }}" title="{{ s.channel|e('html_attr') }} on Twitch" rel="external nofollow">{{ s.channel|e }}</a>{% else %}{{ defaultVal }}{% endif %}</td>
                <td><a href="https://twitch.tv/{{ s.name|e('url')|e('html_attr') }}/following" rel="external nofollow">{{ s.following|default(defaultVal) }}</a></td>
                <td>{% if s.bio is not empty %}<q cite="{{ botUrl|e('html_attr') }}">{{ s.bio|e }}</q>{% else %}{{ defaultVal }}{% endif %}</td>
                <td><a href="https://www.twitch.tv/{{ s.name|e('url')|e('html_attr') }}/videos/all" rel="external nofollow">{{ status(s.vods) }}</a></td>
                <td>{{ status(s.offline) }}</td>
                <td>{{ status(s.online) }}</td>
                <td><a href="https://twitchstuff.3v.fi/modlookup/u/{{ s.name|e('url')|e('html_attr') }}" rel="external nofollow">{{ status(s.ismod) }}</a></td>
                <td>{{ status(s.following_channel) }}</td>
                <td>{{ s.score }}</td>
                {% if buttons %}
                <td>
                    <form method="POST" action="{{ urlFor('submission-action')|e('html_attr') }}" class="form-inline">
                        <input type="hidden" name="id" value="{{ s.id|e('html_attr') }}">
                        <input type="hidden" name="token" value="{{ token|e('html_attr') }}">
                        <button name="approve" value="1" type="submit" class="btn btn-success btn-xs"{% if s.type == 1 %} disabled{% endif %} aria-label="Approve"><span class="glyphicon glyphicon-ok" aria-hidden="true"></span></button>
                    </form>
                </td>
                <td>
                    <button data-toggle="modal" data-target="#editor" class="submission-edit btn btn-info btn-xs{% if s.type == 1 %} disabled{% endif %}" aria-label="Edit"><span class="glyphicon glyphicon-pencil" aria-hidden="true"></span></button>
                </td>
                <td>
                    <form method="POST" action="{{ urlFor('submission-action')|e('html_attr') }}" class="form-inline">
                        <input type="hidden" name="id" value="{{ s.id|e('html_attr') }}">
                        <input type="hidden" name="token" value="{{ token|e('html_attr') }}">
                        <button name="reject" value="1" type="submit" class="btn btn-danger btn-xs" aria-label="Reject"><span class="glyphicon glyphicon-remove" aria-hidden="true"></button>
                    </form>
                </td>
                {% endif %}
            </tr>
{% endfor %}
        </tbody>
    </table>
</div>
{% if buttons %}
<script type="text/javascript" src="{{ siteUrl("/js/editor.js")|e('html_attr') }}"></script>
<div class="modal fade" tabindex="-1" id="editor" aria-labelledby="editorTitle" role="dialog">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <header class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h1 id="editorTitle" class="modal-title">Edit <span class="channel-name">Channel</span></h1>
            </header>
            <section class="modal-body">
                <form class="form-horizontal">
                    <div class="form-group">
                        <label for="channel" class="col-sm-4 control-label">Channel's Twitch Username</label>
                        <div class="col-sm-8">
                            <input type="text" class="form-control" name="channel" id="channel" placeholder="Username" required pattern="[a-zA-Z0-9_]+" autofocus spellcheck="false">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="type" class="col-sm-4 control-label">Bot Type Description</label>
                        <div class="col-sm-8">
                            <input type="text" class="form-control" id="type" name="description" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="col-sm-offset-4 col-sm-8">
                            <input type="hidden" name="id">
                            <input type="hidden" name="token" value="{{ token|e('html_attr') }}">
                            <button type="submit" class="btn btn-success"><span class="glyphicon glyphicon-ok" aria-hidden="true"></span> Save</button>
                        </div>
                    </div>
                </form>
            </section>
        </div>
    </div>
</div>
{% endif %}
{%- endmacro -%}
